<!DOCTYPE html>
<html>
<head>

    <!-- &#1055;&#1086;&#1076;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1077; CSS &#1092;&#1072;&#1081;&#1083;&#1072; -->
    <link rel="stylesheet" href="css1.css">
</head>
<body>



<?php
session_start(); // &#1047;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1084; &#1089;&#1077;&#1089;&#1089;&#1080;&#1102;
// &#1072;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103; &#1079;&#1072;&#1074;&#1091;&#1095;&#1072; &#1080; &#1087;&#1088;&#1077;&#1087;&#1086;&#1076;&#1072;
$_SESSION['role'] = 0;
if (isset($_POST['submit1'])) {
    // &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077; &#1080;&#1079; &#1092;&#1086;&#1088;&#1084;&#1099;

        $username = $_POST['username'];
        $password = $_POST['password'];

    // &#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1095;&#1090;&#1086; &#1087;&#1086;&#1083;&#1103; &#1085;&#1077; &#1087;&#1091;&#1089;&#1090;&#1099;&#1077;
    if (empty($username) || empty($password)) {
        $error = '&#1055;&#1086;&#1078;&#1072;&#1083;&#1091;&#1081;&#1089;&#1090;&#1072;, &#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077; &#1074;&#1089;&#1077; &#1087;&#1086;&#1083;&#1103;'; // &#1054;&#1096;&#1080;&#1073;&#1082;&#1072;, &#1077;&#1089;&#1083;&#1080; &#1087;&#1086;&#1083;&#1103; &#1087;&#1091;&#1089;&#1090;&#1099;&#1077;
    } else {
        // &#1055;&#1086;&#1076;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1084;&#1089;&#1103; &#1082; &#1073;&#1072;&#1079;&#1077; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
        require_once 'setting.php';
        $conn = new mysqli($host, $user, $pass, $data);
// &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072; &#1089;&#1086;&#1077;&#1076;&#1080;&#1085;&#1077;&#1085;&#1080;&#1103;
        if (!$conn) {
            die("Connection failed: " . mysqli_connect_error());
        }
        $algorithm = "sha256";
        $password = hash($algorithm, $password);
        // &#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1095;&#1090;&#1086; &#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100; &#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090; &#1080; &#1087;&#1072;&#1088;&#1086;&#1083;&#1100; &#1074;&#1077;&#1088;&#1085;&#1099;&#1081;
        $sql = "SELECT * FROM users WHERE login='$username' AND passw='$password'";
        $result = mysqli_query($conn, $sql);
        if (!(mysqli_num_rows($result) > 0)) {
            $error = '&#1053;&#1077;&#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1100;&#1085;&#1099;&#1081; &#1083;&#1086;&#1075;&#1080;&#1085; &#1080;&#1083;&#1080; &#1087;&#1072;&#1088;&#1086;&#1083;&#1100;'; // &#1054;&#1096;&#1080;&#1073;&#1082;&#1072;, &#1077;&#1089;&#1083;&#1080; &#1083;&#1086;&#1075;&#1080;&#1085;/&#1087;&#1072;&#1088;&#1086;&#1083;&#1100; &#1085;&#1077; &#1074;&#1077;&#1088;&#1085;&#1099;
        } else {
            // &#1045;&#1089;&#1083;&#1080; &#1083;&#1086;&#1075;&#1080;&#1085;/&#1087;&#1072;&#1088;&#1086;&#1083;&#1100; &#1074;&#1077;&#1088;&#1085;&#1099;, &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103; &#1074; &#1089;&#1077;&#1089;&#1089;&#1080;&#1102;
            $_SESSION['username'] = $username;
            // &#1055;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1085;&#1072; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1091; "index.php" &#1087;&#1086;&#1089;&#1083;&#1077; &#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;&#1081; &#1072;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
            header('Location: gov.php');
            exit;
        }
    }
}

if (isset($_POST['submit'])) {
    // &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077; &#1080;&#1079; &#1092;&#1086;&#1088;&#1084;&#1099;

    $username = $_POST['name'];
    $taskID = $_POST['password'];
    $class = $_POST['class'];

    // &#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1095;&#1090;&#1086; &#1087;&#1086;&#1083;&#1103; &#1085;&#1077; &#1087;&#1091;&#1089;&#1090;&#1099;&#1077;
    if (empty($username) || empty($taskID) || empty($class)) {
        $error = '&#1055;&#1086;&#1078;&#1072;&#1083;&#1091;&#1081;&#1089;&#1090;&#1072;, &#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077; &#1074;&#1089;&#1077; &#1087;&#1086;&#1083;&#1103;';
    } else {
        // &#1055;&#1086;&#1076;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1084;&#1089;&#1103; &#1082; &#1073;&#1072;&#1079;&#1077; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
        require_once 'setting.php';
        $conn = new mysqli($host, $user, $pass, $data);
// &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072; &#1089;&#1086;&#1077;&#1076;&#1080;&#1085;&#1077;&#1085;&#1080;&#1103;
        if (!$conn) {
            die("Connection failed: " . mysqli_connect_error());
        }
        // &#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1095;&#1090;&#1086; &#1076;&#1072;&#1085;&#1085;&#1072;&#1103; &#1082;&#1086;&#1085;&#1090;&#1088;&#1086;&#1083;&#1100;&#1085;&#1072;&#1103; &#1088;&#1072;&#1073;&#1086;&#1090;&#1072; &#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
        $sql = "SELECT * FROM tasks WHERE taskID='$taskID'";
        $result = mysqli_query($conn, $sql);
        if (!(mysqli_num_rows($result) > 0)) {
            $error = '&#1053;&#1077;&#1090; &#1082;&#1086;&#1085;&#1090;&#1088;&#1086;&#1083;&#1100;&#1085;&#1086;&#1081; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1089; &#1090;&#1072;&#1082;&#1080;&#1084; &#1085;&#1086;&#1084;&#1077;&#1088;&#1086;&#1084;!';
        } else {

            $row = mysqli_fetch_assoc($result);
            $nazvanie = $row['name'];
            $_SESSION['class'] = $class;
            $_SESSION['nazvanie'] = $nazvanie;
            $_SESSION['name'] = $username;
            $_SESSION['taskID'] = $taskID;
            $_SESSION['rightanswers'] = 0;
            $_SESSION['number'] = 1;

            $sql = "SELECT * FROM answers WHERE taskID = $taskID AND usrname = '$username' AND class = '$class'";
            $result = mysqli_query($conn, $sql);
            if (!(mysqli_num_rows($result) > 0)) {

                // &#1055;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1085;&#1072; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1091; "letsgo.php"
                header('Location: letsgo.php');
            }
            else $error = '&#1042;&#1099; &#1091;&#1078;&#1077; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1083;&#1080; &#1076;&#1072;&#1085;&#1085;&#1091;&#1102; &#1088;&#1072;&#1073;&#1086;&#1090;&#1091;. &#1045;&#1089;&#1083;&#1080; &#1101;&#1090;&#1086; &#1073;&#1099;&#1083;&#1080; &#1085;&#1077; &#1074;&#1099;, &#1086;&#1073;&#1088;&#1072;&#1090;&#1080;&#1090;&#1077;&#1089;&#1100; &#1082; &#1091;&#1095;&#1080;&#1090;&#1077;&#1083;&#1102;!';
            //exit;
        }
    }
}

// &#1042;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084; &#1092;&#1086;&#1088;&#1084;&#1091;, &#1077;&#1089;&#1083;&#1080; &#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1077; &#1072;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1086;&#1074;&#1072;&#1085;
if (!isset($_SESSION['username'])) {
    // &#1042;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084; &#1086;&#1096;&#1080;&#1073;&#1082;&#1091;, &#1077;&#1089;&#1083;&#1080; &#1086;&#1085;&#1072; &#1077;&#1089;&#1090;&#1100;
    if (isset($error)) {
        echo '<p>' . $error . '</p>';
    }
    // &#1060;&#1086;&#1088;&#1084;&#1072; &#1076;&#1083;&#1103; &#1074;&#1074;&#1086;&#1076;&#1072; &#1083;&#1086;&#1075;&#1080;&#1085;&#1072; &#1080; &#1087;&#1072;&#1088;&#1086;&#1083;&#1103;
   echo '<center>';
    echo '<title>&#1040;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;</title>';
    echo '<form method="post" class="form-wrapper">';
    echo '<h2>&#1053;&#1072;&#1095;&#1072;&#1090;&#1100; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099;</h2>';
    echo '<label>&#1060;&#1072;&#1084;&#1080;&#1083;&#1080;&#1103;, &#1080;&#1084;&#1103;:</label> <br><input type="text" class="rounded-input" placeholder="&#1060;&#1072;&#1084;&#1080;&#1083;&#1080;&#1103;, &#1080;&#1084;&#1103;" name="name"><br>';
    echo '<label>&#1050;&#1083;&#1072;&#1089;&#1089;:</label> <br><input type="text" class="rounded-input" placeholder="&#1050;&#1083;&#1072;&#1089;&#1089;" name="class"><br>';
    echo '<label>&#1055;&#1072;&#1088;&#1086;&#1083;&#1100; &#1086;&#1090; &#1079;&#1072;&#1076;&#1072;&#1085;&#1080;&#1103;:</label> <br><input type="text" class="rounded-input" placeholder="&#1055;&#1072;&#1088;&#1086;&#1083;&#1100; &#1086;&#1090; &#1079;&#1072;&#1076;&#1072;&#1085;&#1080;&#1103;" name="password"><br><br>';
    echo '<input type="submit" name="submit" value="&#1053;&#1072;&#1095;&#1072;&#1090;&#1100; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099;!">';
    echo '</form>';
echo '<hr>';
   echo '<form method="post" class="form-wrapper">';
   echo '<h2>&#1040;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103; &#1076;&#1083;&#1103; &#1091;&#1095;&#1080;&#1090;&#1077;&#1083;&#1077;&#1081; &#1080; &#1079;&#1072;&#1074;&#1091;&#1095;&#1077;&#1081;</h2>';
   echo '<label>&#1051;&#1086;&#1075;&#1080;&#1085;:</label> <br><input type="text" class="rounded-input" placeholder="&#1051;&#1086;&#1075;&#1080;&#1085;" name="username"><br>';
    echo '<label>&#1055;&#1072;&#1088;&#1086;&#1083;&#1100;:</label><br> <input type="password" class="rounded-input" placeholder="&#1055;&#1072;&#1088;&#1086;&#1083;&#1100;" name="password"><br><br>';

    echo '<input type="submit" name="submit1" value="&#1042;&#1086;&#1081;&#1090;&#1080;">';
    echo '</form>';
    echo '</center>';
} else {
    // &#1045;&#1089;&#1083;&#1080; &#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100; &#1091;&#1078;&#1077; &#1072;&#1074;&#1090;&#1086;&#1088;&#1080;&#1079;&#1086;&#1074;&#1072;&#1085;, &#1074;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084; &#1077;&#1075;&#1086; &#1080;&#1084;&#1103; &#1080; &#1082;&#1085;&#1086;&#1087;&#1082;&#1091; "&#1042;&#1099;&#1081;&#1090;&#1080;"
   // echo '&#1044;&#1086;&#1073;&#1088;&#1086; &#1087;&#1086;&#1078;&#1072;&#1083;&#1086;&#1074;&#1072;&#1090;&#1100;, ' . $_SESSION['username'] . '!<br>';
    //echo '<a href="index.php">&#1042;&#1099;&#1081;&#1090;&#1080;</a>';
    header('Location: gov.php');

}